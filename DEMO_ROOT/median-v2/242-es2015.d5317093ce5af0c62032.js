"use strict";(self.webpackChunkmedian=self.webpackChunkmedian||[]).push([[242],{17988:function(t,e,o){o.d(e,{G:function(){return i},T:function(){return a}});var n=o(37716),i=function(){function t(t,e,o){this.el=t,this.vcr=e,this.renderer=o,this.dtOptions={}}return t.prototype.ngOnInit=function(){var t=this;this.dtTrigger?this.dtTrigger.subscribe(function(e){t.displayTable(e)}):this.displayTable(null)},t.prototype.ngOnDestroy=function(){this.dtTrigger&&this.dtTrigger.unsubscribe(),this.dt&&this.dt.destroy(!0)},t.prototype.displayTable=function(t){var e=this;t&&(this.dtOptions=t),this.dtInstance=new Promise(function(t,o){Promise.resolve(e.dtOptions).then(function(n){0===Object.keys(n).length&&0===$("tbody tr",e.el.nativeElement).length?o("Both the table and dtOptions cannot be empty"):setTimeout(function(){var o={rowCallback:function(t,o,i){if(n.columns){var r=n.columns;e.applyNgPipeTransform(t,r),e.applyNgRefTemplate(t,r,o)}n.rowCallback&&n.rowCallback(t,o,i)}};o=Object.assign({},n,o),e.dt=$(e.el.nativeElement).DataTable(o),t(e.dt)})})})},t.prototype.applyNgPipeTransform=function(t,e){e.filter(function(t){return t.ngPipeInstance&&!t.ngTemplateRef}).forEach(function(o){var n=o.ngPipeInstance,i=e.findIndex(function(t){return t.data===o.data}),r=t.childNodes.item(i),a=$(r).text(),s=n.transform(a);$(r).text(s)})},t.prototype.applyNgRefTemplate=function(t,e,o){var n=this;e.filter(function(t){return t.ngTemplateRef&&!t.ngPipeInstance}).forEach(function(i){var r=i.ngTemplateRef,a=r.ref,s=r.context,l=e.findIndex(function(t){return t.data===i.data}),d=t.childNodes.item(l);$(d).html("");var c=Object.assign({},s,null==s?void 0:s.userData,{adtData:o}),u=n.vcr.createEmbeddedView(a,c);n.renderer.appendChild(d,u.rootNodes[0])})},t.\u0275fac=function(e){return new(e||t)(n.Y36(n.SBq),n.Y36(n.s_b),n.Y36(n.Qsj))},t.\u0275dir=n.lG2({type:t,selectors:[["","datatable",""]],inputs:{dtOptions:"dtOptions",dtTrigger:"dtTrigger"}}),t}(),r=o(38583),a=function(){function t(){}return t.forRoot=function(){return{ngModule:t}},t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=n.oAB({type:t}),t.\u0275inj=n.cJS({imports:[[r.ez]]}),t}()},65242:function(t,e,o){o.r(e),o.d(e,{AuditLogsModule:function(){return x}});var n=o(38583),i=o(39895),r=o(4108),a=o.n(r),s=(o(46481),o(16137),o(35383)),l=o(3118),d=o(37716),c=o(94761),u=o(91841),g=o(60965),p=o(77382),f=o(17988);const h=["format"];function m(t,e){if(1&t){const t=d.EpF();d.TgZ(0,"div",7),d.TgZ(1,"label",8),d._uU(2,"Export As"),d.qZA(),d.TgZ(3,"select",9,10),d.TgZ(5,"option",11),d._uU(6,"Excel"),d.qZA(),d.TgZ(7,"option",12),d._uU(8,"PDF"),d.qZA(),d.qZA(),d.TgZ(9,"button",13),d.NdJ("click",function(e){return d.CHM(t),d.oxw().modo(e)}),d._uU(10,"Download"),d.qZA(),d.qZA()}}function b(t,e){if(1&t&&(d.TgZ(0,"tr"),d.TgZ(1,"td"),d._uU(2),d.qZA(),d.TgZ(3,"td"),d._uU(4),d.qZA(),d.TgZ(5,"td"),d._uU(6),d.qZA(),d.TgZ(7,"td"),d._uU(8),d.qZA(),d.TgZ(9,"td"),d._uU(10),d.qZA(),d.TgZ(11,"td"),d._uU(12),d.ALo(13,"date"),d.qZA(),d.qZA()),2&t){const t=e.$implicit;d.xp6(2),d.Oqu(t.log),d.xp6(2),d.Oqu(t.creatorId),d.xp6(2),d.Oqu(t.actionPerformBy),d.xp6(2),d.Oqu(t.record),d.xp6(2),d.Oqu(t.action),d.xp6(2),d.Oqu(d.xi3(13,6,t.creatorDtStamp,"medium"))}}function Z(t,e){if(1&t&&(d.TgZ(0,"tbody"),d.YNc(1,b,14,9,"tr",14),d.qZA()),2&t){const t=d.oxw();d.xp6(1),d.Q6J("ngForOf",t.auditlogdata)}}function A(t,e){1&t&&(d.TgZ(0,"tbody"),d.TgZ(1,"tr"),d.TgZ(2,"td",15),d._uU(3,"No data!"),d.qZA(),d.qZA(),d.qZA())}function T(t,e){1&t&&(d.ynx(0),d.TgZ(1,"div",16),d.TgZ(2,"span",17),d._uU(3,"Please wait... "),d._UZ(4,"span",18),d.qZA(),d.qZA(),d.BQk())}const y=[{path:"",component:(()=>{class t{constructor(t,e,o,i,r){this.api=t,this.http=e,this.excelService=o,this.cdr=i,this.roleService=r,this.isLoading=!1,this.isSelected=!0,this.dtOptions={},this.pipe=new n.uU("en-US"),this.roleCodes=new s.yv,this.API_URL=l.$.baseURL}ngOnInit(){this.dtOptions={pagingType:"full_numbers",pageLength:5,serverSide:!0,processing:!0,columnDefs:[{type:"date",targets:[5]}],order:[[5,"desc"]],lengthMenu:[[5,10,20,30,-1],[5,10,20,30,"ALL"]],ajax:(t,e)=>{t.minNumber=t.start+1,t.maxNumber=t.start+t.length,console.log(t.minNumber,t.maxNumber);const o=Math.floor(t.minNumber/t.length);this.http.get(`${this.API_URL}/auditLogs/getAllAuditLogs?pageNo=${o}&pageSize=${t.length}`).subscribe(t=>{console.log(t),this.totalPages=t.totalNoOfPages,this.totalRecords=t.totalRecords,this.auditlogdata=t.result,this.isLoading=!1,this.cdr.markForCheck(),e({recordsTotal:t.totalRecords,recordsFiltered:t.totalRecords,data:[]})})}},this.roleService.fetchScreenPermissions("Audit Logs"),this.roleService.screenLabelList.subscribe(t=>this.roleCodes=t),console.log(this.roleCodes)}modo(t){console.log(t),"PDF"==this.format.nativeElement.value&&this.downloadLog(this.totalRecords,this.totalPages),"Excel"===this.format.nativeElement.value&&this.exportAsXLSX()}exportAsXLSX(){console.log(this.auditlogdata),this.http.get(`${this.API_URL}/auditLogs/getAllAuditLogs?pageNo=0&pageSize=${this.totalRecords}`).subscribe(t=>{this.arrayData=t.result,this.arrayData.forEach(t=>{t.timeForExport=this.pipe.transform(t.timeForExport,"dd-MMM-yy"),t.updatedAt=this.pipe.transform(t.updatedAt,"dd-MMM-yy"),t.creatorDtStamp=this.pipe.transform(t.creatorDtStamp,"dd-MMM-yy"),t.verifierDtStamp=this.pipe.transform(t.verifierDtStamp,"dd-MMM-yy")}),this.excelService.exportAsExcelFile(this.arrayData,"Audit_Report")})}downloadLog(t,e){this.http.get(`${this.API_URL}/auditLogs/getAllAuditLogs?pageNo=0&pageSize=${t}`).subscribe(t=>{this.convert(t.result)})}convert(t){var e=new(a()),o=[];t.forEach(t=>{var e=new Date(t.creatorDtStamp).toLocaleDateString("en-us");console.log(e),o.push([t.log,t.creatorId,t.actionPerformBy,t.record,t.action,e])}),e.autoTable({head:[["Screen","creatorId","ActionPerformBy","Record","Action","Time"]],body:o}),e.save("AuditLog.pdf")}}return t.\u0275fac=function(e){return new(e||t)(d.Y36(c.sM),d.Y36(u.eN),d.Y36(g.b),d.Y36(d.sBO),d.Y36(p.N))},t.\u0275cmp=d.Xpm({type:t,selectors:[["npr-audit-logs"]],viewQuery:function(t,e){if(1&t&&d.Gf(h,5),2&t){let t;d.iGM(t=d.CRH())&&(e.format=t.first)}},decls:25,vars:5,consts:[[1,"pageContentMain"],[1,"pageTitleCol"],[1,"pageTitle"],["class","col-2",4,"ngIf"],[1,"dbCardStyle","table-responsive"],["id","auditLogsTable","datatable","",1,"table","tableStyle","tableStyleSelect","nowrap","vAlignMdl",2,"width","100%",3,"dtOptions"],[4,"ngIf"],[1,"col-2"],["for","roleName",1,"formLbl"],["aria-label","Default select example",1,"form-select"],["format",""],["selected","","value","Excel"],["value","PDF"],[1,"downloadForAuditLog",3,"click"],[4,"ngFor","ngForOf"],["colspan","3",1,"no-data-available"],[1,"loading-page-center"],[1,"indicator-progress"],[1,"spinner-border","spinner-border-sm","align-middle","ms-2"]],template:function(t,e){1&t&&(d.TgZ(0,"div",0),d.TgZ(1,"div",1),d.TgZ(2,"h2",2),d._uU(3,"Audit Logs"),d.qZA(),d.qZA(),d.YNc(4,m,11,0,"div",3),d._UZ(5,"br"),d.TgZ(6,"div",4),d.TgZ(7,"table",5),d.TgZ(8,"thead"),d.TgZ(9,"tr"),d.TgZ(10,"th"),d._uU(11,"Screen"),d.qZA(),d.TgZ(12,"th"),d._uU(13,"Creator"),d.qZA(),d.TgZ(14,"th"),d._uU(15,"Action Perform By"),d.qZA(),d.TgZ(16,"th"),d._uU(17,"Record"),d.qZA(),d.TgZ(18,"th"),d._uU(19,"Action"),d.qZA(),d.TgZ(20,"th"),d._uU(21,"Date"),d.qZA(),d.qZA(),d.qZA(),d.YNc(22,Z,2,1,"tbody",6),d.YNc(23,A,4,0,"tbody",6),d.qZA(),d.YNc(24,T,5,0,"ng-container",6),d.qZA(),d.qZA()),2&t&&(d.xp6(4),d.Q6J("ngIf",!e.isLoading),d.xp6(3),d.Q6J("dtOptions",e.dtOptions),d.xp6(15),d.Q6J("ngIf",0!=(null==e.auditlogdata?null:e.auditlogdata.length)),d.xp6(1),d.Q6J("ngIf",0==(null==e.auditlogdata?null:e.auditlogdata.length)),d.xp6(1),d.Q6J("ngIf",e.isLoading))},directives:[n.O5,f.G,n.sg],pipes:[n.uU],styles:[".downloadForAuditLog[_ngcontent-%COMP%]{display:inline-block;position:relative;left:250px;bottom:33px;background-color:#d61c4e;color:#f0f8ff;font-family:var(--medium);width:60%;border:0;border-radius:5px}"]}),t})()}];let v=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=d.oAB({type:t}),t.\u0275inj=d.cJS({imports:[[i.Bz.forChild(y)],i.Bz]}),t})(),x=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=d.oAB({type:t}),t.\u0275inj=d.cJS({imports:[[n.ez,v,f.T]]}),t})()}}]);